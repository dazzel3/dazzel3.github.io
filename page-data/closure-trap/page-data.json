{"componentChunkName":"component---src-templates-post-template-tsx","path":"/closure-trap/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<h2>React와 클로저 트랩</h2>\n<h3>클로저(Closure)란 무엇인가?</h3>\n<ul>\n<li><strong>클로저</strong>는 함수가 만들어질 당시의 <strong>외부 환경(스코프)</strong> 을 기억하는 기능이다.</li>\n<li>함수가 실행될 때 그 함수 안에서 선언되지 않은 변수(자유 변수)를 참조하면, 자바스크립트는 함수가 선언된 위치의 변수를 찾아서 기억한다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">outer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> name <span class=\"token operator\">=</span> <span class=\"token string\">\"React\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">inner</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// outer의 변수 name 참조</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> inner<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> fn <span class=\"token operator\">=</span> <span class=\"token function\">outer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// inner 함수 반환</span>\n<span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"React\" 출력</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">inner</code> 함수는 <code class=\"language-text\">outer</code> 함수의 변수를 <strong>기억한다.</strong></li>\n<li>이런 “기억된 함수”를 <strong>클로저</strong>라고 한다.</li>\n</ul>\n<h3>React 함수형 컴포넌트와 클로저</h3>\n<p>React의 함수형 컴포넌트는 사실 <strong>단순한 함수이다.</strong></p>\n<p>하지만 중요한 점은</p>\n<ul>\n<li><strong>렌더링될 때마다 이 함수 전체가 다시 실행된다.</strong></li>\n<li>이 과정에서 내부에 있는 함수들도 <strong>새롭게 생성된다.</strong></li>\n<li>즉, 함수 안에서 이벤트 핸들러나 콜백을 정의하면, 그 함수는 렌더 시점의 상태/props를 <strong>클로저로 기억한다.</strong></li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Counter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">,</span> setCount<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">function</span> <span class=\"token function\">handleClick</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>count<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 현재 렌더 시점의 count 기억</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>handleClick<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Click</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">handleClick</code>은 “버튼이 눌렸을 때 실행되는 함수”인데, 실제로는 <strong>생성 당시의 count 값</strong>을 클로저로 기억한다.</li>\n</ul>\n<h3>클로저 트랩(Closure Trap) 문제</h3>\n<p>클로저 트랩이란? <strong>최신 값이 아니라, 과거 렌더링 때의 값만 계속 참조하는 상황을 뜻한다.</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Timer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">,</span> setCount<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">startTimer</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>count<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ❌ 오래된 count 출력</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">&lt;button onClick=</span><span class=\"token punctuation\">{</span>startTimer<span class=\"token punctuation\">}</span><span class=\"token plain-text\">>Start Timer</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span>c <span class=\"token operator\">=></span> c <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">+1</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>버튼 클릭 시 타이머 설정 → 3초 뒤 실행</li>\n<li>하지만 3초 사이에 count가 변해도, 콜백은 <strong>설정 당시의 count</strong>만 기억함</li>\n<li>이유: <code class=\"language-text\">setTimeout</code> 안의 함수가 생성될 때의 클로저를 참조하기 때문</li>\n</ul>\n<h3>해결 방법</h3>\n<p><strong>1) 의존성 배열 올바르게 작성</strong></p>\n<p><code class=\"language-text\">useEffect</code>, <code class=\"language-text\">useCallback</code> 같은 훅은 의존성 배열을 기반으로 동작한다. 의존성을 정확히 넣어야 매번 새 클로저로 갱신된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> interval <span class=\"token operator\">=</span> <span class=\"token function\">setInterval</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>count<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ✅ 최신 count 출력</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">clearInterval</span><span class=\"token punctuation\">(</span>interval<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// count가 바뀌면 effect 재실행</span></code></pre></div>\n<p><strong>2) useRef로 최신 값 저장</strong></p>\n<p><code class=\"language-text\">useRef</code>는 컴포넌트가 리렌더링되어도 <strong>동일한 객체를 유지</strong>한다. <code class=\"language-text\">.current</code> 값을 갱신하면 항상 최신 값에 접근 가능하다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">const</span> countRef <span class=\"token operator\">=</span> <span class=\"token function\">useRef</span><span class=\"token punctuation\">(</span>count<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  countRef<span class=\"token punctuation\">.</span>current <span class=\"token operator\">=</span> count<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 매 렌더마다 최신값 저장</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> id <span class=\"token operator\">=</span> <span class=\"token function\">setInterval</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>countRef<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ✅ 최신 값 참조</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">clearInterval</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><strong>3) 함수형 업데이트로 안전하게 상태 변경</strong></p>\n<p>콜백 내부에서 오래된 값을 참조할 위험이 있다면, <strong>이전 값(prev)을 기준으로 업데이트</strong>하면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span>prev <span class=\"token operator\">=></span> prev <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ✅ 항상 최신 상태 기준으로 업데이트</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>정리</h3>\n<ul>\n<li>React 함수 컴포넌트는 <strong>렌더링마다 새 함수 실행 → 새 클로저 생성</strong></li>\n<li>이벤트 핸들러/비동기 콜백은 <strong>그 렌더 당시의 상태를 기억</strong></li>\n<li>문제: 오래된 값을 참조하는 “클로저 트랩” 발생</li>\n<li>해결\n<ul>\n<li>의존성 배열 정확히 작성</li>\n<li><code class=\"language-text\">useRef</code>로 최신 값 보관</li>\n<li>함수형 업데이트(<code class=\"language-text\">prev => ...</code>) 활용</li>\n</ul>\n</li>\n</ul>","frontmatter":{"title":"React와 클로저 트랩","summary":"React 함수형 컴포넌트에서 왜 클로저 트랩이 생기는지, 어떻게 해결할 수 있는지 알아보자.","date":"2025.09.08","categories":{"type":["React"],"tags":["React"]},"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAlklEQVR42p2PwQqCQBRF/fva+jdFUJuKEBMdbGpoFwVBZquhmXQ8WdiiIAXv5j24j/Pu9ehQ4RzRKWN9zLgXZdc53j/DVdV7pucb/lziLyRhDX2psfoCcwbThOFMEBwu/YEfPUqHyjXbq8bUe6/KVRNBa81oPEGmG/ZKEScCY2xrytaE1lqk3BFGMctVQCLSGmi+nv4Cn0Kl0vnXTNsKAAAAAElFTkSuQmCC"},"images":{"fallback":{"src":"/static/9ca52ecc81aa3b9cdcf283b0b7699e4e/353ad/react.png","srcSet":"/static/9ca52ecc81aa3b9cdcf283b0b7699e4e/21fc8/react.png 346w,\n/static/9ca52ecc81aa3b9cdcf283b0b7699e4e/168f3/react.png 691w,\n/static/9ca52ecc81aa3b9cdcf283b0b7699e4e/353ad/react.png 1382w","sizes":"(min-width: 1382px) 1382px, 100vw"},"sources":[{"srcSet":"/static/9ca52ecc81aa3b9cdcf283b0b7699e4e/7bd2f/react.webp 346w,\n/static/9ca52ecc81aa3b9cdcf283b0b7699e4e/a8fd0/react.webp 691w,\n/static/9ca52ecc81aa3b9cdcf283b0b7699e4e/8aede/react.webp 1382w","type":"image/webp","sizes":"(min-width: 1382px) 1382px, 100vw"}]},"width":1382,"height":434}},"publicURL":"/static/9ca52ecc81aa3b9cdcf283b0b7699e4e/react.png"}}}}]}},"pageContext":{"slug":"/closure-trap/"}},"staticQueryHashes":[],"slicesMap":{}}